<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Peggy</title>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript" src="peg-0.8.0.js"></script>


<script type='text/javascript'>

function makeTemplate()	{
	window.$template = $("#someTemplate");
	}

function getRules(rulesURL)	{
	console.log(' -> fetching rules: '+rulesURL);
	var rulesReq = $.ajax({
		url : rulesURL,
		dataType : 'text',
		success : function(data)	{
			console.log("Successfully fetched "+rulesURL);
			window.parser = PEG.buildParser(data);
			console.log("Parser built");
			translateTemplate();
			}
		});
	}

function translateTemplate()	{
	console.log(' -> running translateTemplate');
	var addressData = {
		"ship/address1" : "123 evergreen terrace",
		"ship/postal" : "92127"
		}
	$("[data-bind]",$template).each(function(){
		var DB = $(this).data('bind');
		console.log(" -> DB: "+DB);
		parser.parse(DB);
		});
	}

//console.log(parser.parse("hello"));
//console.log(parser.parse("abd"));
</script>
</head>
<body onload="makeTemplate(); getRules('rules.txt');">

<div id='someTemplate'>
	<div data-bind="var:address(ship/address1);format:text;"  title='address'></div>
	<div data-bind="var:address(ship/address2);format:text;"  title='address 2'></div>

	<span data-bind="var:address(ship/city);format:text;"  title='city'></span>
	<span data-bind="var:address(ship/region);format:text;"  title='state'></span>
	<span data-bind="var:address(ship/postal);format:text;"  title='zip'></span>
	<div data-bind="var:address(ship/countrycode);format:text;" title='country'></div>
</div>


</body>
</html>
